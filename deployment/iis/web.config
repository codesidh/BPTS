<?xml version="1.0" encoding="utf-8"?>
<configuration>
  <location path="." inheritInChildApplications="false">
    <system.webServer>
      <!-- ASP.NET Core Module Configuration -->
      <handlers>
        <add name="aspNetCore" path="*" verb="*" modules="AspNetCoreModuleV2" resourceType="Unspecified" />
      </handlers>
      
      <aspNetCore processPath="dotnet" 
                  arguments=".\WorkIntakeSystem.API.dll" 
                  stdoutLogEnabled="false" 
                  stdoutLogFile=".\logs\stdout" 
                  hostingModel="inprocess">
        <environmentVariables>
          <environmentVariable name="ASPNETCORE_ENVIRONMENT" value="Production" />
          <environmentVariable name="ASPNETCORE_HTTPS_PORT" value="443" />
        </environmentVariables>
      </aspNetCore>
      
      <!-- JWT Authentication Configuration -->
      <security>
        <authentication>
          <windowsAuthentication enabled="false" />
          <anonymousAuthentication enabled="true" />
        </authentication>
        <authorization>
          <remove users="*" roles="" verbs="" />
          <add accessType="Allow" users="*" />
        </authorization>
      </security>
      
      <!-- IIS Output Caching Configuration -->
      <caching>
        <profiles>
          <add extension=".css" policy="CacheForTimePeriod" duration="00:01:00:00" />
          <add extension=".js" policy="CacheForTimePeriod" duration="00:01:00:00" />
          <add extension=".png" policy="CacheForTimePeriod" duration="00:01:00:00" />
          <add extension=".jpg" policy="CacheForTimePeriod" duration="00:01:00:00" />
          <add extension=".gif" policy="CacheForTimePeriod" duration="00:01:00:00" />
          <add extension=".ico" policy="CacheForTimePeriod" duration="00:01:00:00" />
          <add extension=".svg" policy="CacheForTimePeriod" duration="00:01:00:00" />
          <add extension=".woff" policy="CacheForTimePeriod" duration="00:01:00:00" />
          <add extension=".woff2" policy="CacheForTimePeriod" duration="00:01:00:00" />
          <add extension=".ttf" policy="CacheForTimePeriod" duration="00:01:00:00" />
          <add extension=".eot" policy="CacheForTimePeriod" duration="00:01:00:00" />
        </profiles>
      </caching>
      
      <!-- Compression Configuration -->
      <httpCompression>
        <dynamicTypes>
          <add mimeType="text/*" enabled="true" />
          <add mimeType="message/*" enabled="true" />
          <add mimeType="application/javascript" enabled="true" />
          <add mimeType="application/json" enabled="true" />
          <add mimeType="application/xml" enabled="true" />
          <add mimeType="*/*" enabled="false" />
        </dynamicTypes>
        <staticTypes>
          <add mimeType="text/*" enabled="true" />
          <add mimeType="message/*" enabled="true" />
          <add mimeType="application/javascript" enabled="true" />
          <add mimeType="application/atom+xml" enabled="true" />
          <add mimeType="application/xaml+xml" enabled="true" />
          <add mimeType="image/svg+xml" enabled="true" />
          <add mimeType="*/*" enabled="false" />
        </staticTypes>
      </httpCompression>
      
      <!-- URL Rewrite for SPA -->
      <rewrite>
        <rules>
          <rule name="SPA Routes" stopProcessing="true">
            <match url=".*" />
            <conditions logicalGrouping="MatchAll">
              <add input="{REQUEST_FILENAME}" matchType="IsFile" negate="true" />
              <add input="{REQUEST_FILENAME}" matchType="IsDirectory" negate="true" />
              <add input="{REQUEST_URI}" pattern="^/(api)" negate="true" />
            </conditions>
            <action type="Rewrite" url="/" />
          </rule>
        </rules>
      </rewrite>
      
      <!-- Security Headers -->
      <httpProtocol>
        <customHeaders>
          <add name="X-Frame-Options" value="SAMEORIGIN" />
          <add name="X-XSS-Protection" value="1; mode=block" />
          <add name="X-Content-Type-Options" value="nosniff" />
          <add name="Referrer-Policy" value="strict-origin-when-cross-origin" />
          <add name="Content-Security-Policy" value="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline'; img-src 'self' data: https:; font-src 'self' data:; connect-src 'self' https:; frame-ancestors 'self';" />
        </customHeaders>
      </httpProtocol>
      
      <!-- Static File Handling -->
      <staticContent>
        <remove fileExtension=".json" />
        <mimeMap fileExtension=".json" mimeType="application/json" />
        <remove fileExtension=".woff" />
        <mimeMap fileExtension=".woff" mimeType="application/font-woff" />
        <remove fileExtension=".woff2" />
        <mimeMap fileExtension=".woff2" mimeType="application/font-woff2" />
      </staticContent>
    </system.webServer>
  </location>
</configuration> 